<cmd>
*JSON 데이터셋을 mongoimport:
mongoimport --db project --collection subway --type json --file C:\bigDataSystem2021\project/seoulSubway.json --jsonArray
mongoimport --db project --collection bus --type json --file C:\bigDataSystem2021\project/seoulBus.json --jsonArray

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<mongoDB 쿼리>
●결손값 제거 쿼리(필드값이 null이거나, 필드가 존재하지 않는 경우, 해당 도큐먼트를 삭제하는 쿼리)
*버스 승차 인원수 필드에 대한 결손값 제거:
db.bus.remove( { midnight_ride_num : null } )
db.bus.remove( { midnight_ride_num : { $exists : false } } )
db.bus.remove( { one_ride_num : null } )
db.bus.remove( { one_ride_num : { $exists : false } } )
db.bus.remove( { two_ride_num : null } )
db.bus.remove( { two_ride_num : { $exists : false } } )
db.bus.remove( { three_ride_num : null } )
db.bus.remove( { three_ride_num : { $exists : false } } )
db.bus.remove( { four_ride_num : null } )
db.bus.remove( { four_ride_num : { $exists : false } } )
db.bus.remove( { five_ride_num : null } )
db.bus.remove( { five_ride_num : { $exists : false } } )
db.bus.remove( { six_ride_num : null } )
db.bus.remove( { six_ride_num : { $exists : false } } )
db.bus.remove( { seven_ride_num : null } )
db.bus.remove( { seven_ride_num : { $exists : false } } )
db.bus.remove( { eight_ride_num : null } )
db.bus.remove( { eight_ride_num : { $exists : false } } )
db.bus.remove( { nine_ride_num : null } )
db.bus.remove( { nine_ride_num : { $exists : false } } )
db.bus.remove( { ten_ride_num : null } )
db.bus.remove( { ten_ride_num : { $exists : false } } )
db.bus.remove( { eleven_ride_num : null } )
db.bus.remove( { eleven_ride_num : { $exists : false } } )
db.bus.remove( { twelve_ride_num : null } )
db.bus.remove( { twelve_ride_num : { $exists : false } } )
db.bus.remove( { thirteen_ride_num : null } )
db.bus.remove( { thirteen_ride_num : { $exists : false } } )
db.bus.remove( { fourteen_ride_num : null } )
db.bus.remove( { fourteen_ride_num : { $exists : false } } )
db.bus.remove( { fifteen_ride_num : null } )
db.bus.remove( { fifteen_ride_num : { $exists : false } } )
db.bus.remove( { sixteen_ride_num : null } )
db.bus.remove( { sixteen_ride_num : { $exists : false } } )
db.bus.remove( { seventeen_ride_num : null } )
db.bus.remove( { seventeen_ride_num : { $exists : false } } )
db.bus.remove( { eighteen_ride_num : null } )
db.bus.remove( { eighteen_ride_num : { $exists : false } } )
db.bus.remove( { nineteen_ride_num : null } )
db.bus.remove( { nineteen_ride_num : { $exists : false } } )
db.bus.remove( { twenty_ride_num : null } )
db.bus.remove( { twenty_ride_num : { $exists : false } } )
db.bus.remove( { twenty_one_ride_num : null } )
db.bus.remove( { twenty_one_ride_num : { $exists : false } } )
db.bus.remove( { twenty_two_ride_num : null } )
db.bus.remove( { twenty_two_ride_num : { $exists : false } } )
db.bus.remove( { twenty_three_ride_num : null } )
db.bus.remove( { twenty_three_ride_num : { $exists : false } } )

*버스 하차 인원수 필드에 대한 결손값 제거:
db.bus.remove( { midnight_alight_num : null } )
db.bus.remove( { midnight_alight_num : { $exists : false } } )
db.bus.remove( { one_alight_num : null } )
db.bus.remove( { one_alight_num : { $exists : false } } )
db.bus.remove( { two_alight_num : null } )
db.bus.remove( { two_alight_num : { $exists : false } } )
db.bus.remove( { three_alight_num : null } )
db.bus.remove( { three_alight_num : { $exists : false } } )
db.bus.remove( { four_alight_num : null } )
db.bus.remove( { four_alight_num : { $exists : false } } )
db.bus.remove( { five_alight_num : null } )
db.bus.remove( { five_alight_num : { $exists : false } } )
db.bus.remove( { six_alight_num : null } )
db.bus.remove( { six_alight_num : { $exists : false } } )
db.bus.remove( { seven_alight_num : null } )
db.bus.remove( { seven_alight_num : { $exists : false } } )
db.bus.remove( { eight_alight_num : null } )
db.bus.remove( { eight_alight_num : { $exists : false } } )
db.bus.remove( { nine_alight_num : null } )
db.bus.remove( { nine_alight_num : { $exists : false } } )
db.bus.remove( { ten_alight_num : null } )
db.bus.remove( { ten_alight_num : { $exists : false } } )
db.bus.remove( { eleven_alight_num : null } )
db.bus.remove( { eleven_alight_num : { $exists : false } } )
db.bus.remove( { twelve_alight_num : null } )
db.bus.remove( { twelve_alight_num : { $exists : false } } )
db.bus.remove( { thirteen_alight_num : null } )
db.bus.remove( { thirteen_alight_num : { $exists : false } } )
db.bus.remove( { fourteen_alight_num : null } )
db.bus.remove( { fourteen_alight_num : { $exists : false } } )
db.bus.remove( { fifteen_alight_num : null } )
db.bus.remove( { fifteen_alight_num : { $exists : false } } )
db.bus.remove( { sixteen_alight_num : null } )
db.bus.remove( { sixteen_alight_num : { $exists : false } } )
db.bus.remove( { seventeen_alight_num : null } )
db.bus.remove( { seventeen_alight_num : { $exists : false } } )
db.bus.remove( { eighteen_alight_num : null } )
db.bus.remove( { eighteen_alight_num : { $exists : false } } )
db.bus.remove( { nineteen_alight_num : null } )
db.bus.remove( { nineteen_alight_num : { $exists : false } } )
db.bus.remove( { twenty_alight_num : null } )
db.bus.remove( { twenty_alight_num : { $exists : false } } )
db.bus.remove( { twenty_one_alight_num : null } )
db.bus.remove( { twenty_one_alight_num : { $exists : false } } )
db.bus.remove( { twenty_two_alight_num : null } )
db.bus.remove( { twenty_two_alight_num : { $exists : false } } )
db.bus.remove( { twenty_three_alight_num : null } )
db.bus.remove( { twenty_three_alight_num : { $exists : false } } )

*지하철 승차 인원수 필드에 대한 결손값 제거:
db.subway.remove( { midnight_ride_num : null } )
db.subway.remove( { midnight_ride_num : { $exists : false } } )
db.subway.remove( { one_ride_num : null } )
db.subway.remove( { one_ride_num : { $exists : false } } )
db.subway.remove( { two_ride_num : null } )
db.subway.remove( { two_ride_num : { $exists : false } } )
db.subway.remove( { three_ride_num : null } )
db.subway.remove( { three_ride_num : { $exists : false } } )
db.subway.remove( { four_ride_num : null } )
db.subway.remove( { four_ride_num : { $exists : false } } )
db.subway.remove( { five_ride_num : null } )
db.subway.remove( { five_ride_num : { $exists : false } } )
db.subway.remove( { six_ride_num : null } )
db.subway.remove( { six_ride_num : { $exists : false } } )
db.subway.remove( { seven_ride_num : null } )
db.subway.remove( { seven_ride_num : { $exists : false } } )
db.subway.remove( { eight_ride_num : null } )
db.subway.remove( { eight_ride_num : { $exists : false } } )
db.subway.remove( { nine_ride_num : null } )
db.subway.remove( { nine_ride_num : { $exists : false } } )
db.subway.remove( { ten_ride_num : null } )
db.subway.remove( { ten_ride_num : { $exists : false } } )
db.subway.remove( { eleven_ride_num : null } )
db.subway.remove( { eleven_ride_num : { $exists : false } } )
db.subway.remove( { twelve_ride_num : null } )
db.subway.remove( { twelve_ride_num : { $exists : false } } )
db.subway.remove( { thirteen_ride_num : null } )
db.subway.remove( { thirteen_ride_num : { $exists : false } } )
db.subway.remove( { fourteen_ride_num : null } )
db.subway.remove( { fourteen_ride_num : { $exists : false } } )
db.subway.remove( { fifteen_ride_num : null } )
db.subway.remove( { fifteen_ride_num : { $exists : false } } )
db.subway.remove( { sixteen_ride_num : null } )
db.subway.remove( { sixteen_ride_num : { $exists : false } } )
db.subway.remove( { seventeen_ride_num : null } )
db.subway.remove( { seventeen_ride_num : { $exists : false } } )
db.subway.remove( { eighteen_ride_num : null } )
db.subway.remove( { eighteen_ride_num : { $exists : false } } )
db.subway.remove( { nineteen_ride_num : null } )
db.subway.remove( { nineteen_ride_num : { $exists : false } } )
db.subway.remove( { twenty_ride_num : null } )
db.subway.remove( { twenty_ride_num : { $exists : false } } )
db.subway.remove( { twenty_one_ride_num : null } )
db.subway.remove( { twenty_one_ride_num : { $exists : false } } )
db.subway.remove( { twenty_two_ride_num : null } )
db.subway.remove( { twenty_two_ride_num : { $exists : false } } )
db.subway.remove( { twenty_three_ride_num : null } )
db.subway.remove( { twenty_three_ride_num : { $exists : false } } )

*지하철 하차 인원수 필드에 대한 결손값 제거:
db.subway.remove( { midnight_alight_num : null } )
db.subway.remove( { midnight_alight_num : { $exists : false } } )
db.subway.remove( { one_alight_num : null } )
db.subway.remove( { one_alight_num : { $exists : false } } )
db.subway.remove( { two_alight_num : null } )
db.subway.remove( { two_alight_num : { $exists : false } } )
db.subway.remove( { three_alight_num : null } )
db.subway.remove( { three_alight_num : { $exists : false } } )
db.subway.remove( { four_alight_num : null } )
db.subway.remove( { four_alight_num : { $exists : false } } )
db.subway.remove( { five_alight_num : null } )
db.subway.remove( { five_alight_num : { $exists : false } } )
db.subway.remove( { six_alight_num : null } )
db.subway.remove( { six_alight_num : { $exists : false } } )
db.subway.remove( { seven_alight_num : null } )
db.subway.remove( { seven_alight_num : { $exists : false } } )
db.subway.remove( { eight_alight_num : null } )
db.subway.remove( { eight_alight_num : { $exists : false } } )
db.subway.remove( { nine_alight_num : null } )
db.subway.remove( { nine_alight_num : { $exists : false } } )
db.subway.remove( { ten_alight_num : null } )
db.subway.remove( { ten_alight_num : { $exists : false } } )
db.subway.remove( { eleven_alight_num : null } )
db.subway.remove( { eleven_alight_num : { $exists : false } } )
db.subway.remove( { twelve_alight_num : null } )
db.subway.remove( { twelve_alight_num : { $exists : false } } )
db.subway.remove( { thirteen_alight_num : null } )
db.subway.remove( { thirteen_alight_num : { $exists : false } } )
db.subway.remove( { fourteen_alight_num : null } )
db.subway.remove( { fourteen_alight_num : { $exists : false } } )
db.subway.remove( { fifteen_alight_num : null } )
db.subway.remove( { fifteen_alight_num : { $exists : false } } )
db.subway.remove( { sixteen_alight_num : null } )
db.subway.remove( { sixteen_alight_num : { $exists : false } } )
db.subway.remove( { seventeen_alight_num : null } )
db.subway.remove( { seventeen_alight_num : { $exists : false } } )
db.subway.remove( { eighteen_alight_num : null } )
db.subway.remove( { eighteen_alight_num : { $exists : false } } )
db.subway.remove( { nineteen_alight_num : null } )
db.subway.remove( { nineteen_alight_num : { $exists : false } } )
db.subway.remove( { twenty_alight_num : null } )
db.subway.remove( { twenty_alight_num : { $exists : false } } )
db.subway.remove( { twenty_one_alight_num : null } )
db.subway.remove( { twenty_one_alight_num : { $exists : false } } )
db.subway.remove( { twenty_two_alight_num : null } )
db.subway.remove( { twenty_two_alight_num : { $exists : false } } )
db.subway.remove( { twenty_three_alight_num : null } )
db.subway.remove( { twenty_three_alight_num : { $exists : false } } )


●Aggregation을 이용한 검색 쿼리
*버스 데이터 - 시간대별 승차 쿼리
db.bus.aggregate([
    {"$project": {"_id": 0, "midnight_ride_num": 1, "one_ride_num": 1, "two_ride_num": 1, "three_ride_num": 1,
                  "four_ride_num": 1, "five_ride_num": 1, "six_ride_num": 1, "seven_ride_num": 1,
                  "eight_ride_num": 1, "nine_ride_num": 1, "ten_ride_num": 1, "eleven_ride_num": 1,
                  "twelve_ride_num": 1, "thirteen_ride_num": 1, "fourteen_ride_num": 1, "fifteen_ride_num": 1,
                  "sixteen_ride_num": 1, "seventeen_ride_num": 1, "eighteen_ride_num": 1, "nineteen_ride_num": 1,
                  "twenty_ride_num": 1, "twenty_one_ride_num": 1, "twenty_two_ride_num": 1, "twenty_three_ride_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ridet_num"}
             }
    }
])

*버스 데이터 - 시간대별 하차 쿼리
db.bus.aggregate([
    {"$project": {"_id": 0, "midnight_alight_num": 1, "one_alight_num": 1, "two_alight_num": 1, "three_alight_num": 1,
                  "four_alight_num": 1, "five_alight_num": 1, "six_alight_num": 1, "seven_alight_num": 1,
                  "eight_alight_num": 1, "nine_alight_num": 1, "ten_alight_num": 1, "eleven_alight_num": 1,
                  "twelve_alight_num": 1, "thirteen_alight_num": 1, "fourteen_alight_num": 1, "fifteen_alight_num": 1,
                  "sixteen_alight_num": 1, "seventeen_alight_num": 1, "eighteen_alight_num": 1, "nineteen_alight_num": 1,
                  "twenty_alight_num": 1, "twenty_one_alight_num": 1, "twenty_two_alight_num": 1, "twenty_three_alight_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    }
])

*지하철 데이터 - 시간대별 승차 쿼리
db.subway.aggregate([
    {"$project": {"_id": 0, "midnight_ride_num": 1, "one_ride_num": 1, "two_ride_num": 1, "three_ride_num": 1,
                  "four_ride_num": 1, "five_ride_num": 1, "six_ride_num": 1, "seven_ride_num": 1,
                  "eight_ride_num": 1, "nine_ride_num": 1, "ten_ride_num": 1, "eleven_ride_num": 1,
                  "twelve_ride_num": 1, "thirteen_ride_num": 1, "fourteen_ride_num": 1, "fifteen_ride_num": 1,
                  "sixteen_ride_num": 1, "seventeen_ride_num": 1, "eighteen_ride_num": 1, "nineteen_ride_num": 1,
                  "twenty_ride_num": 1, "twenty_one_ride_num": 1, "twenty_two_ride_num": 1, "twenty_three_ride_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ridet_num"}
             }
    }
])

*지하철 데이터 - 시간대별 하차 쿼리
db.subway.aggregate([
    {"$project": {"_id": 0, "midnight_alight_num": 1, "one_alight_num": 1, "two_alight_num": 1, "three_alight_num": 1,
                  "four_alight_num": 1, "five_alight_num": 1, "six_alight_num": 1, "seven_alight_num": 1,
                  "eight_alight_num": 1, "nine_alight_num": 1, "ten_alight_num": 1, "eleven_alight_num": 1,
                  "twelve_alight_num": 1, "thirteen_alight_num": 1, "fourteen_alight_num": 1, "fifteen_alight_num": 1,
                  "sixteen_alight_num": 1, "seventeen_alight_num": 1, "eighteen_alight_num": 1, "nineteen_alight_num": 1,
                  "twenty_alight_num": 1, "twenty_one_alight_num": 1, "twenty_two_alight_num": 1, "twenty_three_alight_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    }
])

*버스 데이터 - 정류장별 승차 쿼리
db.bus.aggregate([
    {"$group":
             {
                 "_id": "$bus_sta_nm",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ride_num"}
             }
    },
    {"$project": {"_id": 1,
                  "rideNum": {"$add": ["$midnight_ride_num", "$one_ride_num", "$two_ride_num", "$three_ride_num",
                                      "$four_ride_num", "$five_ride_num", "$six_ride_num", "$seven_ride_num",
                                      "$eight_ride_num", "$nine_ride_num", "$ten_ride_num", "$eleven_ride_num",
                                      "$twelve_ride_num", "$thirteen_ride_num", "$fourteen_ride_num",
                                      "$fifteen_ride_num", "$sixteen_ride_num", "$seventeen_ride_num",
                                      "$eighteen_ride_num", "$nineteen_ride_num", "$twenty_ride_num",
                                      "$twenty_one_ride_num", "$twenty_two_ride_num", "$twenty_three_ride_num"]}}},
    {"$sort": {"rideNum": -1}},
    {"$limit": 5}

])

*버스 데이터 - 정류장별 하차 쿼리
db.bus.aggregate([
    {"$group":
             {
                 "_id": "$bus_sta_nm",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    },
    {"$project": {"_id": 1,
                  "alightNum": {"$add": ["$midnight_alight_num", "$one_alight_num", "$two_alight_num", "$three_alight_num",
                                      "$four_alight_num", "$five_alight_num", "$six_alight_num", "$seven_alight_num",
                                      "$eight_alight_num", "$nine_alight_num", "$ten_alight_num", "$eleven_alight_num",
                                      "$twelve_alight_num", "$thirteen_alight_num", "$fourteen_alight_num",
                                      "$fifteen_alight_num", "$sixteen_alight_num", "$seventeen_alight_num",
                                      "$eighteen_alight_num", "$nineteen_alight_num", "$twenty_alight_num",
                                      "$twenty_one_alight_num", "$twenty_two_alight_num", "$twenty_three_alight_num"]}}},
    {"$sort": {"alightNum": -1}},
    {"$limit": 5}

])

*버스 데이터 - 노선 번호별 승차 쿼리
db.bus.aggregate([
    {"$group":
             {
                 "_id": "$bus_route_no",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ride_num"}
             }
    },
    {"$project": {"_id": 1,
                  "rideNum": {"$add": ["$midnight_ride_num", "$one_ride_num", "$two_ride_num", "$three_ride_num",
                                      "$four_ride_num", "$five_ride_num", "$six_ride_num", "$seven_ride_num",
                                      "$eight_ride_num", "$nine_ride_num", "$ten_ride_num", "$eleven_ride_num",
                                      "$twelve_ride_num", "$thirteen_ride_num", "$fourteen_ride_num",
                                      "$fifteen_ride_num", "$sixteen_ride_num", "$seventeen_ride_num",
                                      "$eighteen_ride_num", "$nineteen_ride_num", "$twenty_ride_num",
                                      "$twenty_one_ride_num", "$twenty_two_ride_num", "$twenty_three_ride_num"]}}},
    {"$sort": {"rideNum": -1}},
    {"$limit": 5}

])

*버스 데이터 - 노선 번호별 하차 쿼리
db.bus.aggregate([
    {"$group":
             {
                 "_id": "$bus_route_no",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    },
    {"$project": {"_id": 1,
                  "alightNum": {"$add": ["$midnight_alight_num", "$one_alight_num", "$two_alight_num", "$three_alight_num",
                                      "$four_alight_num", "$five_alight_num", "$six_alight_num", "$seven_alight_num",
                                      "$eight_alight_num", "$nine_alight_num", "$ten_alight_num", "$eleven_alight_num",
                                      "$twelve_alight_num", "$thirteen_alight_num", "$fourteen_alight_num",
                                      "$fifteen_alight_num", "$sixteen_alight_num", "$seventeen_alight_num",
                                      "$eighteen_alight_num", "$nineteen_alight_num", "$twenty_alight_num",
                                      "$twenty_one_alight_num", "$twenty_two_alight_num", "$twenty_three_alight_num"]}}},
    {"$sort": {"alightNum": -1}},
    {"$limit": 5}

])


●인덱싱으로 최적화하는 쿼리
*버스 노선번호 필드 및 정류장명 필드에 대한 인덱싱
db.bus.createIndex( { bus_route_no: 1 } )
db.bus.createIndex( { bus_sta_nm: 1 } )

*지하철 호선명 필드 및 역명 필드에 대한 인덱싱
db.subway.createIndex( { line_num: 1 } )
db.subway.createIndex( { sub_sta_nm: 1 } )


●최적화 전후 실행시간 측정 쿼리
*버스 데이터 - 시간대별 승차 쿼리
db.bus.explain("executionStats").aggregate([
    {"$project": {"_id": 0, "midnight_ride_num": 1, "one_ride_num": 1, "two_ride_num": 1, "three_ride_num": 1,
                  "four_ride_num": 1, "five_ride_num": 1, "six_ride_num": 1, "seven_ride_num": 1,
                  "eight_ride_num": 1, "nine_ride_num": 1, "ten_ride_num": 1, "eleven_ride_num": 1,
                  "twelve_ride_num": 1, "thirteen_ride_num": 1, "fourteen_ride_num": 1, "fifteen_ride_num": 1,
                  "sixteen_ride_num": 1, "seventeen_ride_num": 1, "eighteen_ride_num": 1, "nineteen_ride_num": 1,
                  "twenty_ride_num": 1, "twenty_one_ride_num": 1, "twenty_two_ride_num": 1, "twenty_three_ride_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ridet_num"}
             }
    }
])

*버스 데이터 - 시간대별 하차 쿼리
db.bus.explain("executionStats").aggregate([
    {"$project": {"_id": 0, "midnight_alight_num": 1, "one_alight_num": 1, "two_alight_num": 1, "three_alight_num": 1,
                  "four_alight_num": 1, "five_alight_num": 1, "six_alight_num": 1, "seven_alight_num": 1,
                  "eight_alight_num": 1, "nine_alight_num": 1, "ten_alight_num": 1, "eleven_alight_num": 1,
                  "twelve_alight_num": 1, "thirteen_alight_num": 1, "fourteen_alight_num": 1, "fifteen_alight_num": 1,
                  "sixteen_alight_num": 1, "seventeen_alight_num": 1, "eighteen_alight_num": 1, "nineteen_alight_num": 1,
                  "twenty_alight_num": 1, "twenty_one_alight_num": 1, "twenty_two_alight_num": 1, "twenty_three_alight_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    }
])

*지하철 데이터 - 시간대별 승차 쿼리
db.subway.explain("executionStats").aggregate([
    {"$project": {"_id": 0, "midnight_ride_num": 1, "one_ride_num": 1, "two_ride_num": 1, "three_ride_num": 1,
                  "four_ride_num": 1, "five_ride_num": 1, "six_ride_num": 1, "seven_ride_num": 1,
                  "eight_ride_num": 1, "nine_ride_num": 1, "ten_ride_num": 1, "eleven_ride_num": 1,
                  "twelve_ride_num": 1, "thirteen_ride_num": 1, "fourteen_ride_num": 1, "fifteen_ride_num": 1,
                  "sixteen_ride_num": 1, "seventeen_ride_num": 1, "eighteen_ride_num": 1, "nineteen_ride_num": 1,
                  "twenty_ride_num": 1, "twenty_one_ride_num": 1, "twenty_two_ride_num": 1, "twenty_three_ride_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ridet_num"}
             }
    }
])

*지하철 데이터 - 시간대별 하차 쿼리
db.subway.explain("executionStats").aggregate([
    {"$project": {"_id": 0, "midnight_alight_num": 1, "one_alight_num": 1, "two_alight_num": 1, "three_alight_num": 1,
                  "four_alight_num": 1, "five_alight_num": 1, "six_alight_num": 1, "seven_alight_num": 1,
                  "eight_alight_num": 1, "nine_alight_num": 1, "ten_alight_num": 1, "eleven_alight_num": 1,
                  "twelve_alight_num": 1, "thirteen_alight_num": 1, "fourteen_alight_num": 1, "fifteen_alight_num": 1,
                  "sixteen_alight_num": 1, "seventeen_alight_num": 1, "eighteen_alight_num": 1, "nineteen_alight_num": 1,
                  "twenty_alight_num": 1, "twenty_one_alight_num": 1, "twenty_two_alight_num": 1, "twenty_three_alight_num": 1}},
    {"$group":
             {
                 "_id": "null",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    }
])

*버스 데이터 - 정류장별 승차 쿼리
db.bus.explain("executionStats").aggregate([
    {"$group":
             {
                 "_id": "$bus_sta_nm",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ride_num"}
             }
    },
    {"$project": {"_id": 1,
                  "rideNum": {"$add": ["$midnight_ride_num", "$one_ride_num", "$two_ride_num", "$three_ride_num",
                                      "$four_ride_num", "$five_ride_num", "$six_ride_num", "$seven_ride_num",
                                      "$eight_ride_num", "$nine_ride_num", "$ten_ride_num", "$eleven_ride_num",
                                      "$twelve_ride_num", "$thirteen_ride_num", "$fourteen_ride_num",
                                      "$fifteen_ride_num", "$sixteen_ride_num", "$seventeen_ride_num",
                                      "$eighteen_ride_num", "$nineteen_ride_num", "$twenty_ride_num",
                                      "$twenty_one_ride_num", "$twenty_two_ride_num", "$twenty_three_ride_num"]}}},
    {"$sort": {"rideNum": -1}},
    {"$limit": 5}

])

*버스 데이터 - 정류장별 하차 쿼리
db.bus.explain("executionStats").aggregate([
    {"$group":
             {
                 "_id": "$bus_sta_nm",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    },
    {"$project": {"_id": 1,
                  "alightNum": {"$add": ["$midnight_alight_num", "$one_alight_num", "$two_alight_num", "$three_alight_num",
                                      "$four_alight_num", "$five_alight_num", "$six_alight_num", "$seven_alight_num",
                                      "$eight_alight_num", "$nine_alight_num", "$ten_alight_num", "$eleven_alight_num",
                                      "$twelve_alight_num", "$thirteen_alight_num", "$fourteen_alight_num",
                                      "$fifteen_alight_num", "$sixteen_alight_num", "$seventeen_alight_num",
                                      "$eighteen_alight_num", "$nineteen_alight_num", "$twenty_alight_num",
                                      "$twenty_one_alight_num", "$twenty_two_alight_num", "$twenty_three_alight_num"]}}},
    {"$sort": {"alightNum": -1}},
    {"$limit": 5}

])

*버스 데이터 - 노선 번호별 승차 쿼리
db.bus.explain("executionStats").aggregate([
    {"$group":
             {
                 "_id": "$bus_route_no",
                 "midnight_ride_num": {"$avg": "$midnight_ride_num"},
                 "one_ride_num": {"$avg": "$one_ride_num"},
                 "two_ride_num": {"$avg": "$two_ride_num"},
                 "three_ride_num": {"$avg": "$three_ride_num"},
                 "four_ride_num": {"$avg": "$four_ride_num"},
                 "five_ride_num": {"$avg": "$five_ride_num"},
                 "six_ride_num": {"$avg": "$six_ride_num"},
                 "seven_ride_num": {"$avg": "$seven_ride_num"},
                 "eight_ride_num": {"$avg": "$eight_ride_num"},
                 "nine_ride_num": {"$avg": "$nine_ride_num"},
                 "ten_ride_num": {"$avg": "$ten_ride_num"},
                 "eleven_ride_num": {"$avg": "$eleven_ride_num"},
                 "twelve_ride_num": {"$avg": "$twelve_ride_num"},
                 "thirteen_ride_num": {"$avg": "$thirteen_ride_num"},
                 "fourteen_ride_num": {"$avg": "$fourteen_ride_num"},
                 "fifteen_ride_num": {"$avg": "$fifteen_ride_num"},
                 "sixteen_ride_num": {"$avg": "$sixteen_ride_num"},
                 "seventeen_ride_num": {"$avg": "$seventeen_ride_num"},
                 "eighteen_ride_num": {"$avg": "$eighteen_ride_num"},
                 "nineteen_ride_num": {"$avg": "$nineteen_ride_num"},
                 "twenty_ride_num": {"$avg": "$twenty_ride_num"},
                 "twenty_one_ride_num": {"$avg": "$twenty_one_ride_num"},
                 "twenty_two_ride_num": {"$avg": "$twenty_two_ride_num"},
                 "twenty_three_ride_num": {"$avg": "$twenty_three_ride_num"}
             }
    },
    {"$project": {"_id": 1,
                  "rideNum": {"$add": ["$midnight_ride_num", "$one_ride_num", "$two_ride_num", "$three_ride_num",
                                      "$four_ride_num", "$five_ride_num", "$six_ride_num", "$seven_ride_num",
                                      "$eight_ride_num", "$nine_ride_num", "$ten_ride_num", "$eleven_ride_num",
                                      "$twelve_ride_num", "$thirteen_ride_num", "$fourteen_ride_num",
                                      "$fifteen_ride_num", "$sixteen_ride_num", "$seventeen_ride_num",
                                      "$eighteen_ride_num", "$nineteen_ride_num", "$twenty_ride_num",
                                      "$twenty_one_ride_num", "$twenty_two_ride_num", "$twenty_three_ride_num"]}}},
    {"$sort": {"rideNum": -1}},
    {"$limit": 5}

])

*버스 데이터 - 노선 번호별 하차 쿼리
db.bus.explain("executionStats").aggregate([
    {"$group":
             {
                 "_id": "$bus_route_no",
                 "midnight_alight_num": {"$avg": "$midnight_alight_num"},
                 "one_alight_num": {"$avg": "$one_alight_num"},
                 "two_alight_num": {"$avg": "$two_alight_num"},
                 "three_alight_num": {"$avg": "$three_alight_num"},
                 "four_alight_num": {"$avg": "$four_alight_num"},
                 "five_alight_num": {"$avg": "$five_alight_num"},
                 "six_alight_num": {"$avg": "$six_alight_num"},
                 "seven_alight_num": {"$avg": "$seven_alight_num"},
                 "eight_alight_num": {"$avg": "$eight_alight_num"},
                 "nine_alight_num": {"$avg": "$nine_alight_num"},
                 "ten_alight_num": {"$avg": "$ten_alight_num"},
                 "eleven_alight_num": {"$avg": "$eleven_alight_num"},
                 "twelve_alight_num": {"$avg": "$twelve_alight_num"},
                 "thirteen_alight_num": {"$avg": "$thirteen_alight_num"},
                 "fourteen_alight_num": {"$avg": "$fourteen_alight_num"},
                 "fifteen_alight_num": {"$avg": "$fifteen_alight_num"},
                 "sixteen_alight_num": {"$avg": "$sixteen_alight_num"},
                 "seventeen_alight_num": {"$avg": "$seventeen_alight_num"},
                 "eighteen_alight_num": {"$avg": "$eighteen_alight_num"},
                 "nineteen_alight_num": {"$avg": "$nineteen_alight_num"},
                 "twenty_alight_num": {"$avg": "$twenty_alight_num"},
                 "twenty_one_alight_num": {"$avg": "$twenty_one_alight_num"},
                 "twenty_two_alight_num": {"$avg": "$twenty_two_alight_num"},
                 "twenty_three_alight_num": {"$avg": "$twenty_three_alight_num"}
             }
    },
    {"$project": {"_id": 1,
                  "alightNum": {"$add": ["$midnight_alight_num", "$one_alight_num", "$two_alight_num", "$three_alight_num",
                                      "$four_alight_num", "$five_alight_num", "$six_alight_num", "$seven_alight_num",
                                      "$eight_alight_num", "$nine_alight_num", "$ten_alight_num", "$eleven_alight_num",
                                      "$twelve_alight_num", "$thirteen_alight_num", "$fourteen_alight_num",
                                      "$fifteen_alight_num", "$sixteen_alight_num", "$seventeen_alight_num",
                                      "$eighteen_alight_num", "$nineteen_alight_num", "$twenty_alight_num",
                                      "$twenty_one_alight_num", "$twenty_two_alight_num", "$twenty_three_alight_num"]}}},
    {"$sort": {"alightNum": -1}},
    {"$limit": 5}

])


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<레플리카셋 구성하는 커맨드 및 쿼리>

*1. 1번째 cmd를 관리자 권한으로 실행
cd C:\Program Files\MongoDB\Server\4.4\bin

mongod --dbpath "C:\Program Files\MongoDB\Server\4.4\data" --logpath "C:\Program Files\MongoDB\Server\4.4\log\mongod.log" --port 27017 --storageEngine=wiredTiger --journal --replSet bigDataProject


*2. 2번째 cmd를 관리자 권한으로 실행
mongo --port 27017

show dbs

rsconf = { _id:"bigDataProject", members:[ { _id:0, host:"localhost:27017" } ] }

rs.initiate(rsconf)

show dbs


*3. 3번째 cmd를 관리자 권한으로 실행
cd C:\Program Files\MongoDB\Server\4.4\bin

mongod --dbpath "C:\bigData_project_replication\data1\db" --logpath "C:\bigData_project_replication\data1\log\mongod.log" --port 27020 --storageEngine=wiredTiger --journal --replSet bigDataProject


*4. 4번째 cmd를 관리자 권한으로 실행
cd C:\Program Files\MongoDB\Server\4.4\bin

mongod --dbpath "C:\bigData_project_replication\data2\db" --logpath "C:\bigData_project_replication\data2\log\mongod.log" --port 27021 --storageEngine=wiredTiger --journal --replSet bigDataProject


*5. 열어둔 2번째 cmd로 돌아와서 실행
rs.add("localhost:27020")

rs.add("localhost:27021")

rs.status()

show dbs

rs.isMaster()


*6. 5번째 cmd를 관리자 권한으로 실행
mongo --port 27020

rs.slaveOk()

rs.secondaryOk()

show dbs

rs.isMaster()


*7. 6번째 cmd를 관리자 권한으로 실행
mongo --port 27021

rs.slaveOk()

rs.secondaryOk()

show dbs

rs.isMaster()



